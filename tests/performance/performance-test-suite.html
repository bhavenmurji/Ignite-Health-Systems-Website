<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Testing Suite - Ignite Health Systems</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .metric {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 4px solid #ddd;
        }
        .metric.excellent { border-color: #28a745; background: #d4edda; }
        .metric.good { border-color: #ffc107; background: #fff3cd; }
        .metric.poor { border-color: #dc3545; background: #f8d7da; }
        .performance-score {
            font-size: 48px;
            font-weight: bold;
            text-align: center;
            padding: 20px;
            border-radius: 50%;
            width: 120px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
        }
        .performance-score.excellent { background: #28a745; color: white; }
        .performance-score.good { background: #ffc107; color: black; }
        .performance-score.poor { background: #dc3545; color: white; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover { background: #0056b3; }
        .chart-container {
            height: 300px;
            margin: 20px 0;
            position: relative;
        }
        .network-sim {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .network-sim select {
            padding: 8px;
            margin: 0 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <h1>⚡ Performance Testing Suite</h1>
    <p>Comprehensive performance analysis for Ignite Health Systems website</p>

    <div class="test-container">
        <h2>Test Controls</h2>
        <button onclick="runPerformanceTests()">Run Performance Tests</button>
        <button onclick="runResourceAnalysis()">Analyze Resources</button>
        <button onclick="runNetworkTests()">Test Network Conditions</button>
        <button onclick="runMemoryTests()">Memory Usage Tests</button>
        <button onclick="generatePerformanceReport()">Generate Report</button>
        
        <div class="network-sim">
            <label>Simulate Network:</label>
            <select id="networkType" onchange="simulateNetwork()">
                <option value="online">No throttling</option>
                <option value="slow-3g">Slow 3G</option>
                <option value="fast-3g">Fast 3G</option>
                <option value="4g">4G</option>
                <option value="offline">Offline</option>
            </select>
        </div>
    </div>

    <div id="performance-results"></div>

    <script>
        let performanceData = {};
        let performanceObserver;

        class PerformanceTester {
            constructor() {
                this.metrics = {};
                this.resources = [];
                this.observations = [];
            }

            async runAllTests() {
                console.log('🚀 Starting Performance Analysis...');
                
                await this.measureCoreWebVitals();
                await this.measureLoadTimes();
                await this.analyzeResources();
                await this.measureMemoryUsage();
                await this.measureInteractivity();
                
                this.displayResults();
            }

            async measureCoreWebVitals() {
                console.log('📊 Measuring Core Web Vitals...');
                
                return new Promise((resolve) => {
                    // Largest Contentful Paint (LCP)
                    if ('PerformanceObserver' in window) {
                        const lcpObserver = new PerformanceObserver((list) => {
                            const entries = list.getEntries();
                            const lastEntry = entries[entries.length - 1];
                            this.metrics.lcp = Math.round(lastEntry.startTime);
                            lcpObserver.disconnect();
                        });
                        lcpObserver.observe({entryTypes: ['largest-contentful-paint']});

                        // First Input Delay (FID) - simulated
                        document.addEventListener('click', this.measureFID.bind(this), { once: true });

                        // Cumulative Layout Shift (CLS)
                        const clsObserver = new PerformanceObserver((list) => {
                            let clsValue = 0;
                            for (const entry of list.getEntries()) {
                                if (!entry.hadRecentInput) {
                                    clsValue += entry.value;
                                }
                            }
                            this.metrics.cls = Math.round(clsValue * 1000) / 1000;
                        });
                        clsObserver.observe({entryTypes: ['layout-shift']});
                    }

                    // Navigation timing
                    const navigation = performance.getEntriesByType('navigation')[0];
                    if (navigation) {
                        this.metrics.ttfb = Math.round(navigation.responseStart - navigation.requestStart);
                        this.metrics.domLoad = Math.round(navigation.domContentLoadedEventEnd - navigation.domContentLoadedEventStart);
                        this.metrics.loadComplete = Math.round(navigation.loadEventEnd - navigation.loadEventStart);
                    }

                    setTimeout(resolve, 1000);
                });
            }

            measureFID(event) {
                const fidStart = performance.now();
                requestIdleCallback(() => {
                    this.metrics.fid = Math.round(performance.now() - fidStart);
                });
            }

            async measureLoadTimes() {
                console.log('⏱️ Measuring Load Times...');
                
                const paintEntries = performance.getEntriesByType('paint');
                paintEntries.forEach(entry => {
                    if (entry.name === 'first-paint') {
                        this.metrics.fp = Math.round(entry.startTime);
                    } else if (entry.name === 'first-contentful-paint') {
                        this.metrics.fcp = Math.round(entry.startTime);
                    }
                });

                // Time to Interactive (TTI) - simplified calculation
                this.metrics.tti = Math.round(performance.now());
            }

            async analyzeResources() {
                console.log('📦 Analyzing Resources...');
                
                const resources = performance.getEntriesByType('resource');
                
                let totalSize = 0;
                let imageSize = 0;
                let jsSize = 0;
                let cssSize = 0;
                let slowResources = 0;

                resources.forEach(resource => {
                    const size = resource.transferSize || 0;
                    totalSize += size;
                    
                    if (resource.duration > 1000) slowResources++;
                    
                    if (resource.name.match(/\.(jpg|jpeg|png|gif|svg|webp)$/i)) {
                        imageSize += size;
                    } else if (resource.name.match(/\.js$/i)) {
                        jsSize += size;
                    } else if (resource.name.match(/\.css$/i)) {
                        cssSize += size;
                    }
                });

                this.metrics.totalResources = resources.length;
                this.metrics.totalSize = Math.round(totalSize / 1024); // KB
                this.metrics.imageSize = Math.round(imageSize / 1024);
                this.metrics.jsSize = Math.round(jsSize / 1024);
                this.metrics.cssSize = Math.round(cssSize / 1024);
                this.metrics.slowResources = slowResources;
            }

            async measureMemoryUsage() {
                console.log('💾 Measuring Memory Usage...');
                
                if ('memory' in performance) {
                    this.metrics.memoryUsed = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024); // MB
                    this.metrics.memoryTotal = Math.round(performance.memory.totalJSHeapSize / 1024 / 1024);
                    this.metrics.memoryLimit = Math.round(performance.memory.jsHeapSizeLimit / 1024 / 1024);
                }
            }

            async measureInteractivity() {
                console.log('🖱️ Measuring Interactivity...');
                
                // Measure button click responsiveness
                const buttons = document.querySelectorAll('button, a, [onclick]');
                this.metrics.interactiveElements = buttons.length;

                // Simulate interaction test
                let totalResponseTime = 0;
                let testCount = 0;

                buttons.forEach(button => {
                    if (testCount < 5) { // Test first 5 elements
                        const startTime = performance.now();
                        button.addEventListener('click', () => {
                            totalResponseTime += performance.now() - startTime;
                            testCount++;
                        }, { once: true });
                    }
                });

                this.metrics.avgResponseTime = testCount > 0 ? Math.round(totalResponseTime / testCount) : 0;
            }

            calculatePerformanceScore() {
                let score = 100;
                
                // LCP scoring
                if (this.metrics.lcp > 4000) score -= 25;
                else if (this.metrics.lcp > 2500) score -= 10;
                
                // FCP scoring
                if (this.metrics.fcp > 3000) score -= 20;
                else if (this.metrics.fcp > 1800) score -= 10;
                
                // CLS scoring
                if (this.metrics.cls > 0.25) score -= 25;
                else if (this.metrics.cls > 0.1) score -= 10;
                
                // Resource size penalty
                if (this.metrics.totalSize > 5000) score -= 15;
                else if (this.metrics.totalSize > 3000) score -= 8;
                
                // Slow resources penalty
                score -= this.metrics.slowResources * 5;
                
                return Math.max(0, Math.round(score));
            }

            getMetricGrade(metric, value) {
                const thresholds = {
                    lcp: { excellent: 2500, good: 4000 },
                    fcp: { excellent: 1800, good: 3000 },
                    cls: { excellent: 0.1, good: 0.25 },
                    ttfb: { excellent: 800, good: 1800 },
                    totalSize: { excellent: 1500, good: 3000 }
                };
                
                const threshold = thresholds[metric];
                if (!threshold) return 'good';
                
                if (value <= threshold.excellent) return 'excellent';
                if (value <= threshold.good) return 'good';
                return 'poor';
            }

            displayResults() {
                const score = this.calculatePerformanceScore();
                let scoreClass = 'poor';
                if (score >= 90) scoreClass = 'excellent';
                else if (score >= 70) scoreClass = 'good';

                const resultsHTML = `
                    <div class="test-container">
                        <h2>Performance Results</h2>
                        <div class="performance-score ${scoreClass}">
                            ${score}
                        </div>
                        <h3>Core Web Vitals</h3>
                        <div class="metric ${this.getMetricGrade('lcp', this.metrics.lcp)}">
                            <span>Largest Contentful Paint (LCP)</span>
                            <span>${this.metrics.lcp || 'N/A'}ms</span>
                        </div>
                        <div class="metric ${this.getMetricGrade('fcp', this.metrics.fcp)}">
                            <span>First Contentful Paint (FCP)</span>
                            <span>${this.metrics.fcp || 'N/A'}ms</span>
                        </div>
                        <div class="metric ${this.getMetricGrade('cls', this.metrics.cls)}">
                            <span>Cumulative Layout Shift (CLS)</span>
                            <span>${this.metrics.cls || 'N/A'}</span>
                        </div>
                        <div class="metric ${this.getMetricGrade('ttfb', this.metrics.ttfb)}">
                            <span>Time to First Byte (TTFB)</span>
                            <span>${this.metrics.ttfb || 'N/A'}ms</span>
                        </div>
                        
                        <h3>Resource Analysis</h3>
                        <div class="metric ${this.getMetricGrade('totalSize', this.metrics.totalSize)}">
                            <span>Total Page Size</span>
                            <span>${this.metrics.totalSize || 'N/A'}KB</span>
                        </div>
                        <div class="metric">
                            <span>Total Resources</span>
                            <span>${this.metrics.totalResources || 'N/A'}</span>
                        </div>
                        <div class="metric">
                            <span>Image Size</span>
                            <span>${this.metrics.imageSize || 'N/A'}KB</span>
                        </div>
                        <div class="metric">
                            <span>JavaScript Size</span>
                            <span>${this.metrics.jsSize || 'N/A'}KB</span>
                        </div>
                        <div class="metric">
                            <span>CSS Size</span>
                            <span>${this.metrics.cssSize || 'N/A'}KB</span>
                        </div>
                        
                        <h3>Memory Usage</h3>
                        <div class="metric">
                            <span>JS Heap Used</span>
                            <span>${this.metrics.memoryUsed || 'N/A'}MB</span>
                        </div>
                        <div class="metric">
                            <span>JS Heap Total</span>
                            <span>${this.metrics.memoryTotal || 'N/A'}MB</span>
                        </div>
                        
                        <h3>Recommendations</h3>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 4px; margin-top: 20px;">
                            ${this.generateRecommendations()}
                        </div>
                    </div>
                `;

                document.getElementById('performance-results').innerHTML = resultsHTML;
            }

            generateRecommendations() {
                const recommendations = [];
                
                if (this.metrics.lcp > 2500) {
                    recommendations.push('• Optimize Largest Contentful Paint by compressing images and reducing server response times');
                }
                
                if (this.metrics.fcp > 1800) {
                    recommendations.push('• Improve First Contentful Paint by minimizing render-blocking resources');
                }
                
                if (this.metrics.cls > 0.1) {
                    recommendations.push('• Reduce Cumulative Layout Shift by setting size attributes on images and videos');
                }
                
                if (this.metrics.totalSize > 3000) {
                    recommendations.push('• Reduce total page size by optimizing images and minifying CSS/JavaScript');
                }
                
                if (this.metrics.slowResources > 3) {
                    recommendations.push('• Optimize slow-loading resources or consider lazy loading');
                }
                
                if (recommendations.length === 0) {
                    recommendations.push('• Great job! Your website performance is excellent.');
                }
                
                return recommendations.join('<br>');
            }
        }

        let performanceTester = new PerformanceTester();

        function runPerformanceTests() {
            performanceTester.runAllTests();
        }

        function runResourceAnalysis() {
            performanceTester.analyzeResources();
            performanceTester.displayResults();
        }

        function runNetworkTests() {
            console.log('🌐 Testing Network Conditions...');
            // This would require Service Worker for actual network throttling
            alert('Network testing requires Service Worker implementation. Check browser DevTools for network throttling options.');
        }

        function runMemoryTests() {
            performanceTester.measureMemoryUsage();
            performanceTester.displayResults();
        }

        function simulateNetwork() {
            const networkType = document.getElementById('networkType').value;
            console.log(`📶 Simulating ${networkType} network conditions...`);
            // This would require Service Worker for actual implementation
        }

        function generatePerformanceReport() {
            if (Object.keys(performanceTester.metrics).length === 0) {
                alert('Please run performance tests first!');
                return;
            }

            const report = {
                timestamp: new Date().toISOString(),
                score: performanceTester.calculatePerformanceScore(),
                metrics: performanceTester.metrics,
                recommendations: performanceTester.generateRecommendations(),
                userAgent: navigator.userAgent
            };

            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `performance-report-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            console.log('📊 Performance Report Generated:', report);
        }

        // Auto-run basic performance tests on page load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                console.log('🔍 Auto-running basic performance checks...');
                performanceTester.measureLoadTimes();
                performanceTester.analyzeResources();
                performanceTester.measureMemoryUsage();
                performanceTester.displayResults();
            }, 2000);
        });
    </script>
</body>
</html>